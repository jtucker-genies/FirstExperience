!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["genies-typescript-compiler-plugin"]=t():e["genies-typescript-compiler-plugin"]=t()}(this,(()=>(()=>{"use strict";var e={71:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.convertToAssetsRelativePath=t.updateImportsToRelativePaths=t.isGeniesScriptType=t.getGeniesScriptTypeFromType=t.getIsUnityAPIDeclaration=t.getIsUnityAPIType=t.getIsValidUnityGenericTypeArg=t.extractProperties=t.getFullTypeName=t.getTypeNameAndEnsureImported=t.getUnaryOperatorMethodReturnType=t.isOrInheritsFromGameObjectOrComponent=t.getOperatorMethodReturnType=t.isGeniesEventType=t.isSignalBusType=t.getOperatorMethodName=t.traversePrototypeChain=t.removeDecorators=t.extendsScriptableObject=t.extendsMonoBehaviour=t.GeniesScriptType=t.UiInterfaceToEnumMap=t.AllowedUiInterfaces=t.GeniesScriptUiEvents=t.componentMethods=t.SET_ITEM_NAME=t.GET_ITEM_NAME=t.TooltipDecorator=t.SpaceDecorator=t.HeaderDecorator=t.SerializeFieldDecorator=t.HideInInspectorDecorator=t.NonSerializedDecorator=t.ScriptableObjectTypeName=t.MonobehaviourTypeName=t.GeniesInstancePropName=t.GeniesDeclarationFileAnnotation=void 0;const s=n(710),a=o(n(928));var l,c;function p(e){let t=e.getBaseClass();for(;t;){if("MonoBehaviour"===t.getName())return!0;t=t.getBaseClass()}return!1}function g(e){let t=e.getBaseClass();for(;t;){if("ScriptableObject"===t.getName())return!0;t=t.getBaseClass()}return!1}function d(e,t,n){var i;const r=function(e,t){const n=[],i=e.getSymbol();if(!i)return n;const r=i.getDeclarations();if(!r)return n;for(const e of r)if(s.Node.isClassDeclaration(e)){const i=e.getHeritageClauses();for(const e of i){const i=e.getTypeNodes();for(const e of i){const i=t.typeChecker.getTypeAtLocation(e);i&&n.push(i)}}}return n}(e,n);for(const e of r){const r=null===(i=e.getSymbol())||void 0===i?void 0:i.getName();if(r&&t.includes(r))return!0;if(d(e,t,n))return!0}return!1}function m(e,t=!0,n=!0){let i="";const r=e.getAliasSymbol();if(i=r?r.getName():e.getText(),["float","int","double","long","bool","string"].includes(i))switch(i){case"int":return"System.Int32";case"string":return"System.String";case"bool":return"System.Boolean";case"float":return"System.Single";case"long":return"System.Int64";case"double":return"System.Double";default:return i}const o=e.getSymbol();if(!o)return i;if(C(e))i=o.getFullyQualifiedName().replace(/['"]/g,"");else{const e=o.getDeclarations();let t=!1;if(e.forEach((e=>{(s.Node.isInterfaceDeclaration(e)||s.Node.isClassDeclaration(e))&&(t=e.isExported())})),!t&&e.length>0){const t=e[0].getSourceFile(),n=t.getFilePath(),r=x(t.getDirectoryPath(),n),s=a.parse(r),l=a.join(s.dir,s.name);i=`${l}.${o.getFullyQualifiedName().replace(/['"]/g,"")}`}else i=o.getFullyQualifiedName().replace(/['"]/g,"");i.indexOf("Assets/")>=0&&(i=i.slice(i.indexOf("Assets"))),i.indexOf("PackageCache/")>=0&&(i=i.slice(i.indexOf("PackageCache")).replace("PackageCache","Packages")),i.indexOf("GeniesSharedPackages/")>=0&&(i=i.slice(i.indexOf("GeniesSharedPackages")).replace("GeniesSharedPackages","Packages"))}const l=/\$\d+$/;if(t&&l.test(i)&&(i=i.replace(l,""),n)){const t=e.getTypeArguments();t.length>0&&(i+="<",t.forEach(((e,n)=>{let r=m(e);i+=r,n<t.length-1&&(i+=", ")})),i+=">")}return i}function u(e,n="",i=new Map){const r=[];return e.getProperties().forEach((e=>{const o=e.getScope(),a=D(e);if("private"===o&&!a.some((e=>e.Type===t.SerializeFieldDecorator)))return;if("public"===o&&a.some((e=>e.Type===t.NonSerializedDecorator)))return;const l=f(e.getType(),i),c=l.isArray(),p=S(l,i),g=m(p),d=e.getName();let u=n?`${n}.${d}`:d;function E(e){if(e.getKind()===s.SyntaxKind.NewExpression){const t=e;return`new ${m(t.getType())}(${t.getArguments().map((e=>e.getText())).join(", ")});`}return e.getText()}const C=[];if(e.hasInitializer()){const t=e.getInitializer();if(t)if(t.getKind()===s.SyntaxKind.ArrayLiteralExpression){const e=t;for(let t=0;t<e.getElements().length;t++){const n=e.getElements()[t];C.push(E(n))}}else C.push(E(t))}const T={Path:u,Name:d,TypeName:g,ChildProperties:[],IsArray:c,IsEnum:!1,EnumKeys:[],EnumValues:[],Decorators:D(e),IsGeniesBehaviourRef:!1,IsGeniesScriptableObjectRef:!1,Initializers:C,ArrayElementInitializer:void 0,ArrayDimension:-1};if(c){let e=1;return T.ArrayElementInitializer=y(l,g,d,u,e,i),T.ArrayDimension=e,void r.push(T)}h(p,T,i),r.push(T)})),r}function h(e,t,n){const i=e.isEnum(),r=e.getSymbol()||e.getAliasSymbol();if(!r)return;const o=r.getDeclarations()[0],a=T(o),l=v(o,a);if(t.IsGeniesBehaviourRef=l==c.Monobehaviour,t.IsGeniesScriptableObjectRef=l==c.ScriptableObject,!a&&l===c.None&&(i&&function(e,t){const{keys:n,values:i}=function(e){const t=e.getSymbol(),n=null==t?void 0:t.getDeclarations().find((e=>e.getKind()===s.SyntaxKind.EnumDeclaration));return n?{keys:n.getMembers().map((e=>e.getName())),values:n.getMembers().map((e=>e.getValue()))}:{keys:[],values:[]}}(t);e.EnumKeys=n,e.EnumValues=i.map((e=>void 0===e?"":e.toString())),e.IsEnum=!0}(t,e),r.getDeclarations().some((e=>s.Node.isClassDeclaration(e))))){const i=r.getDeclarations().find(s.Node.isClassDeclaration),o=i.getTypeParameters(),a=e.getTypeArguments(),l=new Map(n);o.forEach(((e,t)=>{const n=`${e.getName()}_${i.getName()}`;l.set(n,a[t])}));const c=[];let p=i;for(;p;){p.getName(),c.unshift(...u(p,t.Path,l));let e=p.getBaseClass();if(void 0===e)break;p=e}t.ChildProperties=c}}function y(e,t,n,i,r,o){let s=e.isArray()?e.getArrayElementType():e;s.isArray()||(s=S(s,o));let a=r;const l={Path:i+"_D"+r,Name:n,TypeName:t,ArrayDimension:r,ChildProperties:[],IsArray:s.isArray(),IsEnum:s.isEnum(),EnumKeys:[],EnumValues:[],Decorators:[],IsGeniesBehaviourRef:!1,IsGeniesScriptableObjectRef:!1,Initializers:[],ArrayElementInitializer:void 0};return s.isArray()?l.ArrayElementInitializer=y(s,t,n,i,++a,o):h(s,l,o),l}function f(e,t){var n,i;let r=e;if(r.isTypeParameter()){const e=null===(n=r.getSymbol())||void 0===n?void 0:n.getName(),o=null===(i=r.getSymbol())||void 0===i?void 0:i.getDeclarations()[0].getParent(),a=`${e}_${o&&s.Node.isClassDeclaration(o)?o.getName():""}`;a&&t.has(a)&&(r=t.get(a))}return r}function S(e,t){let n=e;for(;null==n?void 0:n.isArray();)n=n.getArrayElementType();return n=f(n,t),n}function E(e){const n=e.getFirstChild();if(!n)return console.log("No nodes found in the file."),!1;const i=n.getLeadingCommentRanges();return i.length>0&&i[0].getText()===t.GeniesDeclarationFileAnnotation}function C(e){const t=e.getSymbol();if(t)return E(t.getDeclarations()[0].getSourceFile())}function T(e){return E(e.getSourceFile())}function v(e,t){if(e.getKind()!==s.SyntaxKind.ClassDeclaration||t)return c.None;const n=e,i=p(n),r=g(n);return i?c.Monobehaviour:r?c.ScriptableObject:c.None}function b(e){const t=e.getSymbol();if(!t)return c.None;const n=t.getDeclarations();if(0===n.length)return c.None;const i=n[0];return v(i,T(i))}function x(e,t){const n=a.resolve(e,t),i=a.resolve("Assets");let r=a.relative(i,n);return r.startsWith("Assets"+a.sep)||(r=a.join("Assets",r)),r.split(a.sep).join("/")}function D(e){return e.getDecorators().map((e=>({Type:e.getName(),Args:e.getArguments().map((e=>e.getText()))})))}t.GeniesDeclarationFileAnnotation="//@Genies-UnityApiInterface",t.GeniesInstancePropName="__geniesInstance__",t.MonobehaviourTypeName="MonoBehaviour",t.ScriptableObjectTypeName="ScriptableObject",t.NonSerializedDecorator="NonSerialized",t.HideInInspectorDecorator="HideInInspector",t.SerializeFieldDecorator="SerializeField",t.HeaderDecorator="Header",t.SpaceDecorator="Space",t.TooltipDecorator="Tooltip",t.GET_ITEM_NAME="get_Item",t.SET_ITEM_NAME="set_Item",t.componentMethods=new Set(["GetComponent","TryGetComponent","GetComponentInChildren","GetComponentsInChildren","GetComponentInParent","GetComponentsInParent","GetComponents","AddComponent"]),function(e){e[e.None=0]="None",e[e.PointerClick=1]="PointerClick",e[e.PointerDown=2]="PointerDown",e[e.PointerEnter=4]="PointerEnter",e[e.PointerExit=8]="PointerExit",e[e.PointerUp=16]="PointerUp",e[e.BeginDrag=32]="BeginDrag",e[e.Deselect=64]="Deselect",e[e.Drag=128]="Drag",e[e.Drop=256]="Drop",e[e.EndDrag=512]="EndDrag",e[e.InitializePotentialDrag=1024]="InitializePotentialDrag",e[e.Scroll=2048]="Scroll",e[e.Select=4096]="Select",e[e.Submit=8192]="Submit",e[e.UpdateSelected=16384]="UpdateSelected",e[e.Move=32768]="Move",e[e.Cancel=65536]="Cancel"}(l||(t.GeniesScriptUiEvents=l={})),t.AllowedUiInterfaces=new Set(["UnityEngine.EventSystems.IPointerClickHandler","UnityEngine.EventSystems.IPointerDownHandler","UnityEngine.EventSystems.IPointerEnterHandler","UnityEngine.EventSystems.IPointerExitHandler","UnityEngine.EventSystems.IPointerUpHandler","UnityEngine.EventSystems.IBeginDragHandler","UnityEngine.EventSystems.IDeselectHandler","UnityEngine.EventSystems.IDragHandler","UnityEngine.EventSystems.IDropHandler","UnityEngine.EventSystems.IEndDragHandler","UnityEngine.EventSystems.IInitializePotentialDragHandler","UnityEngine.EventSystems.IScrollHandler","UnityEngine.EventSystems.ISelectHandler","UnityEngine.EventSystems.ISubmitHandler","UnityEngine.EventSystems.IUpdateSelectedHandler","UnityEngine.EventSystems.IMoveHandler","UnityEngine.EventSystems.ICancelHandler"]),t.UiInterfaceToEnumMap=new Map([["UnityEngine.EventSystems.IPointerClickHandler",l.PointerClick],["UnityEngine.EventSystems.IPointerDownHandler",l.PointerDown],["UnityEngine.EventSystems.IPointerEnterHandler",l.PointerEnter],["UnityEngine.EventSystems.IPointerExitHandler",l.PointerExit],["UnityEngine.EventSystems.IPointerUpHandler",l.PointerUp],["UnityEngine.EventSystems.IBeginDragHandler",l.BeginDrag],["UnityEngine.EventSystems.IDeselectHandler",l.Deselect],["UnityEngine.EventSystems.IDragHandler",l.Drag],["UnityEngine.EventSystems.IDropHandler",l.Drop],["UnityEngine.EventSystems.IEndDragHandler",l.EndDrag],["UnityEngine.EventSystems.IInitializePotentialDragHandler",l.InitializePotentialDrag],["UnityEngine.EventSystems.IScrollHandler",l.Scroll],["UnityEngine.EventSystems.ISelectHandler",l.Select],["UnityEngine.EventSystems.ISubmitHandler",l.Submit],["UnityEngine.EventSystems.IUpdateSelectedHandler",l.UpdateSelected],["UnityEngine.EventSystems.IMoveHandler",l.Move],["UnityEngine.EventSystems.ICancelHandler",l.Cancel]]),function(e){e[e.None=0]="None",e[e.Monobehaviour=1]="Monobehaviour",e[e.ScriptableObject=2]="ScriptableObject"}(c||(t.GeniesScriptType=c={})),t.extendsMonoBehaviour=p,t.extendsScriptableObject=g,t.removeDecorators=function(e,t){e.forEach((e=>{t(e)&&e.remove()}))},t.traversePrototypeChain=function(e){const t=new Set;let n=e;for(;n;){const e=m(n.getType());e&&t.add(e),n.getImplements().forEach((e=>{const n=[e.getType()];for(;n.length>0;){const e=n.shift();if(!e)continue;const i=m(e);i&&!t.has(i)&&(t.add(i),e.getBaseTypes().forEach((e=>{n.push(e)})))}})),n=n.getBaseClass()}return Array.from(t)},t.getOperatorMethodName=function(e){switch(e){case s.SyntaxKind.EqualsEqualsToken:return"op_Equality";case s.SyntaxKind.ExclamationEqualsToken:return"op_Inequality";case s.SyntaxKind.GreaterThanToken:return"op_GreaterThan";case s.SyntaxKind.LessThanToken:return"op_LessThan";case s.SyntaxKind.GreaterThanEqualsToken:return"op_GreaterThanOrEqual";case s.SyntaxKind.LessThanEqualsToken:return"op_LessThanOrEqual";case s.SyntaxKind.AmpersandToken:return"op_BitwiseAnd";case s.SyntaxKind.BarToken:return"op_BitwiseOr";case s.SyntaxKind.PlusToken:return"op_Addition";case s.SyntaxKind.MinusToken:return"op_Subtraction";case s.SyntaxKind.SlashToken:return"op_Division";case s.SyntaxKind.PercentToken:return"op_Modulus";case s.SyntaxKind.AsteriskToken:return"op_Multiply";case s.SyntaxKind.LessThanLessThanToken:return"op_LeftShift";case s.SyntaxKind.GreaterThanGreaterThanToken:return"op_RightShift";case s.SyntaxKind.CaretToken:return"op_ExclusiveOr";case s.SyntaxKind.ExclamationToken:return"op_LogicalNot";case s.SyntaxKind.TildeToken:return"op_OnesComplement";case s.SyntaxKind.PlusPlusToken:return"op_Increment";case s.SyntaxKind.MinusMinusToken:return"op_Decrement";default:return}},t.isSignalBusType=function(e){const t=e.getSymbol();return!!t&&"SignalBus"===t.getName()},t.isGeniesEventType=function(e){const t=e.getSymbol();return!!t&&"GeniesEvent"===t.getName()},t.getOperatorMethodReturnType=function(e,t,n){const i=e.getSymbol();if(!i)return null;let r=e.getText(),o=n.getText();const a=i.getDeclarations();for(const e of a)if(s.Node.isClassDeclaration(e)){const n=e.getMethods().filter((e=>e.getName()===t&&0===e.getTypeParameters().length));for(const e of n){const t=e.getParameters();if(2===t.length){const n=t[0].getType(),i=t[1].getType();if(n.getText()===r&&i.getText()===o)return e.getReturnType()}}}return null},t.isOrInheritsFromGameObjectOrComponent=function(e,t){if(!e)return!1;const n=e.getSymbol();return!!n&&(!!["GameObject","Component","MonoBehaviour"].includes(n.getName())||d(e,["GameObject","Component","MonoBehaviour"],t))},t.getUnaryOperatorMethodReturnType=function(e,t){const n=e.getSymbol();if(!n)return null;const i=n.getDeclarations();for(const n of i)if(s.Node.isClassDeclaration(n)){const i=n.getMethods().filter((e=>e.getName()===t&&0===e.getTypeParameters().length));for(const t of i){const n=t.getParameters();if(1===n.length&&n[0].getType().getText()===e.getText())return t.getReturnType()}}return null},t.getTypeNameAndEnsureImported=function(e,t){let n=e.getText(void 0,s.TypeFormatFlags.None),i="";if(["float","int","double","long","bool","string","number"].includes(n)){switch(n){case"int":n="Int32";break;case"bool":n="Boolean";break;case"float":n="Single";break;case"long":n="Int64";break;case"double":case"number":n="Double";break;case"string":n="String"}i="System"}else{const t=b(e);if(t!==c.None)switch(t){case c.Monobehaviour:n="MonoBehaviour",i="UnityEngine";break;case c.ScriptableObject:n="ScriptableObject",i="UnityEngine"}else{if(!C(e))throw new Error("Can't use non CSharp types");{const t=m(e),n=t.lastIndexOf(".");i=t.substring(0,n)}}}const r=t.getImportDeclarations().find((e=>e.getModuleSpecifierValue()===i));if(r)r.getNamedImports().some((e=>e.getName()===n))||r.addNamedImport(n);else{const e={kind:s.StructureKind.ImportDeclaration,moduleSpecifier:i,namedImports:[{name:n}]};t.addImportDeclaration(e)}return n},t.getFullTypeName=m,t.extractProperties=u,t.getIsValidUnityGenericTypeArg=function(e){let t="";const n=e.getAliasSymbol();return t=n?n.getName():e.getText(),!!["float","int","double","long","bool","string","number"].includes(t)||b(e)!==c.None||C(e)},t.getIsUnityAPIType=C,t.getIsUnityAPIDeclaration=T,t.getGeniesScriptTypeFromType=b,t.isGeniesScriptType=function(e){let t=b(e);return t===c.Monobehaviour||t===c.ScriptableObject},t.updateImportsToRelativePaths=function(e){const t=e.getDirectoryPath();e.getImportDeclarations().forEach((e=>{const n=e.getModuleSpecifierValue();if(n.startsWith("./")||n.startsWith("../")){const i=x(t,n);e.setModuleSpecifier(i)}}))},t.convertToAssetsRelativePath=x},105:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getGeniesSemanticDiagnostics=void 0;const r=n(710),o=i(n(985)),s=n(71),a=10001,l=10002,c=10003,p=10004,g=10005,d=10006,m=new Set(["MonoBehaviour","ScriptableObject"]),u=new Set(["GetComponent","TryGetComponent","GetComponentInChildren","GetComponentsInChildren","GetComponentInParent","GetComponentsInParent","GetComponents","AddComponent"]);function h(e,t,n,i){const r=t.getStart(),s=t.getWidth(),a={file:t.getSourceFile().compilerNode,start:r,length:s,messageText:n,category:o.default.DiagnosticCategory.Error,code:i,source:"Genies"};e.push(a)}t.getGeniesSemanticDiagnostics=function(e,t){if(!e)return[];const n=[];return function(e,t){e.getClasses().forEach((n=>{const i=n.getBaseClass(),r=n.getImplements(),c=null==i?void 0:i.getName();if(i&&(0,s.getIsUnityAPIType)(i.getType())&&c&&!m.has(c)){const r=i.getStart(),s=i.getWidth(),l=`Class '${n.getName()}' inherits from a Unity type '${i.getName()}' that is not 'MonoBehaviour' or 'ScriptableObject'.`,c={file:e.compilerNode,start:r,length:s,messageText:l,category:o.default.DiagnosticCategory.Error,code:a,source:"Genies"};t.push(c)}r.forEach((i=>{if((0,s.getIsUnityAPIType)(i.getType())){const r=(0,s.getFullTypeName)(i.getType());if(s.AllowedUiInterfaces.has(r))return;const a=i.getStart(),c=i.getWidth(),p=`Class '${n.getName()}' implements a forbidden Unity interface '${i.getText()}'.`,g={file:e.compilerNode,start:a,length:c,messageText:p,category:o.default.DiagnosticCategory.Error,code:l,source:"Genies"};t.push(g)}}))}))}(e,n),function(e,t){e.getDescendantsOfKind(r.SyntaxKind.CallExpression).forEach((e=>{!function(e,t){const n=e.getExpression();let i=[];if(r.Node.isPropertyAccessExpression(n)||r.Node.isIdentifier(n)){const e=n.getSymbol();e&&(i=e.getDeclarations().filter((e=>r.Node.isMethodDeclaration(e))))}if(0===i.length)return;if(!(i.filter((e=>e.getTypeParameters().length>0)).length>0))return;if(i=i.filter((e=>(0,s.getIsUnityAPIDeclaration)(e))),0===i.length)return;const o=function(e){return r.Node.isPropertyAccessExpression(e)?e.getName():r.Node.isIdentifier(e)?e.getText():""}(n);if(function(e,t){const n=t.getArguments().map((e=>e.getType())),i=t.getProject().getTypeChecker();return e.some((e=>{if(e.getTypeParameters().length>0)return!1;const t=e.getParameters();if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++){const r=t[e].getType(),o=n[e];if(!i.isTypeAssignableTo(o,r))return!1}return!0}))}(i,e))return;const a=e.getTypeArguments();if(0===a.length)return void h(t,e,`Generic method '${o}' must be called with type arguments.`,c);let l=i.map((e=>e.getTypeParameters().length));l.includes(a.length)||h(t,e,`Generic method '${o}' was provided the wrong number of arguments. Valid args counts: '${l.join(", ")}'`,d),u.has(o)?a.forEach((e=>{(function(e){const t=e.getType();if((0,s.getIsUnityAPIType)(t))return!0;if((0,s.getGeniesScriptTypeFromType)(t)===s.GeniesScriptType.Monobehaviour)return!0;const n=t.getSymbol();if(n){const e=n.getDeclarations();if(e&&e.length>0&&r.Node.isInterfaceDeclaration(e[0]))return!0}return!1})(e)||h(t,e,`Type arguments for method '${o}' must be a Unity API type, an interface, or a type that extends MonoBehaviour.`,p)})):a.forEach((e=>{const n=e.getType();(0,s.getIsValidUnityGenericTypeArg)(n)||h(t,e,`Type arguments for method '${o}' must be Unity API types.`,p)}))}(e,t)}))}(e,n),function(e,t){e.getDescendantsOfKind(r.SyntaxKind.NewExpression).forEach((e=>{const n=e.getType().getSymbol();if(!n)return;const i=n.getDeclarations();if(!i||0===i.length)return;const o=i.filter((e=>r.Node.isClassDeclaration(e)&&(0,s.getIsUnityAPIDeclaration)(e)&&e.getTypeParameters().length>0));if(0===o.length)return;const a=o[0].getTypeParameters().length,l=e.getTypeArguments(),c=l.length;0===c?h(t,e,`Generic class '${(0,s.getFullTypeName)(e.getType())}' must be instantiated with ${a} type argument(s).`,g):(c!==a&&h(t,e,`Generic class '${(0,s.getFullTypeName)(e.getType())}' expects ${a} type argument(s), but got ${c}.`,d),l.forEach((n=>{const i=n.getType();(0,s.getIsValidUnityGenericTypeArg)(i)||h(t,n,`Type arguments for type '${(0,s.getFullTypeName)(e.getType())}' must be Unity API types.`,d)})))}))}(e,n),n}},54:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CSharpOperatorOverloadingSuppress=void 0;const i=n(710),r=n(71);t.CSharpOperatorOverloadingSuppress=class{constructor(e){this.cache=new Map,this.expressionValidity=new Map,this.context=e}get Logger(){return this.context.Logger}enhanceProxy(e){const t=e.getSemanticDiagnostics;e.getSemanticDiagnostics=e=>this.getSemanticDiagnostics(t,e)}getSemanticDiagnostics(e,t){var n,i;const r=e(t);let o=this.context.getSourceFile(t);if(!o)return r;this.collectExpressions(o);let s=r.filter((e=>{var t,n,i;const r=null!==(t=e.start)&&void 0!==t?t:0,o=(null!==(n=e.start)&&void 0!==n?n:0)+(null!==(i=e.length)&&void 0!==i?i:0);for(const{start:e,end:t,valid:n}of this.expressionValidity.values())if((r>=e||o<=t)&&n)return!1;return!0}));return null===(n=this.expressionValidity)||void 0===n||n.clear(),null===(i=this.cache)||void 0===i||i.clear(),s}collectExpressions(e){const t=e.getDescendantsOfKind(i.SyntaxKind.BinaryExpression),n=e.getDescendantsOfKind(i.SyntaxKind.PrefixUnaryExpression),r=e.getDescendantsOfKind(i.SyntaxKind.PostfixUnaryExpression),o=e.getDescendantsOfKind(i.SyntaxKind.BinaryExpression).filter((e=>{const t=e.getOperatorToken().getKind();return t>=i.SyntaxKind.FirstCompoundAssignment&&t<=i.SyntaxKind.LastCompoundAssignment})),s=e=>{const t=e.getStart();if(this.expressionValidity.has(t))return;const n=this.getFinalType(e),i=e.getEnd(),r=void 0!==n;this.expressionValidity.set(t,{start:t,end:i,valid:r})};t.forEach(s),n.forEach(s),r.forEach(s),o.forEach(s)}getFinalType(e){if(this.cache.has(e))return this.cache.get(e);let t;if(i.Node.isBinaryExpression(e)){const n=e.getOperatorToken().getKind(),i=e.getLeft(),o=e.getRight(),s=this.getFinalType(i),a=this.getFinalType(o),l=(0,r.getOperatorMethodName)(n);if(l&&s&&a){const e=(0,r.getOperatorMethodReturnType)(s,l,a),n=(0,r.getOperatorMethodReturnType)(a,l,s);t=e||n||void 0}else t=void 0}else if(i.Node.isPrefixUnaryExpression(e)||i.Node.isPostfixUnaryExpression(e)){const n=e.getOperand(),i=e.getOperatorToken(),o=(0,r.getOperatorMethodName)(i),s=this.context.TypeChecker.getTypeAtLocation(n);if(o){t=(0,r.getUnaryOperatorMethodReturnType)(s,o)||void 0}else t=void 0}else t=this.context.TypeChecker.getTypeAtLocation(e),(null==t?void 0:t.isLiteral())&&(t=this.context.TypeChecker.getBaseTypeOfLiteralType(t));return this.cache.set(e,t),t}}},865:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeniesSemanticDiagnostics=void 0;const i=n(105);t.GeniesSemanticDiagnostics=class{constructor(e){this.context=e}get Logger(){return this.context.Logger}enhanceProxy(e){const t=e.getSemanticDiagnostics;e.getSemanticDiagnostics=e=>{let n=t(e);return n=this.getGeniesSemanticDiagnostics(n,e),n}}getGeniesSemanticDiagnostics(e,t){const n=this.context.getSourceFile(t);if(!n)return e;const r=(0,i.getGeniesSemanticDiagnostics)(n,this.context.TypeChecker);return[...e.filter((e=>!r.some((t=>t.messageText===e.messageText&&t.start===e.start&&t.length===e.length)))),...r]}}},335:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeniesLSPContext=void 0,t.GeniesLSPContext=class{constructor(e,t){this.project=e,this.info=t}get Logger(){return this.info.project.projectService.logger}get TypeChecker(){return this.project.getTypeChecker()}getSourceFile(e){let t=this.project.getSourceFile(e);if(!t&&(t=this.project.addSourceFileAtPath(e),!t))return void this.Logger.info("Source file not found.");const n=this.getInMemoryFileContent(e,this.info.languageServiceHost);return n&&t.replaceWithText(n),t}getInMemoryFileContent(e,t){const n=t.getScriptSnapshot(e);return n?n.getText(0,n.getLength()):void 0}}},60:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptableObjectAllowedMethods=t.unityLifecycleMethods=void 0,t.unityLifecycleMethods=[{name:"Awake",parameters:"",description:"Called when the script instance is being loaded.",imports:[]},{name:"Start",parameters:"",description:"Called before the first frame update.",imports:[]},{name:"OnEnable",parameters:"",description:"Called when the object becomes enabled and active.",imports:[]},{name:"OnDisable",parameters:"",description:"Called when the object becomes disabled.",imports:[]},{name:"OnDestroy",parameters:"",description:"Called when the MonoBehaviour will be destroyed.",imports:[]},{name:"Update",parameters:"",description:"Called once per frame.",imports:[]},{name:"FixedUpdate",parameters:"",description:"Called every fixed frame-rate frame.",imports:[]},{name:"LateUpdate",parameters:"",description:"Called once per frame after Update.",imports:[]},{name:"OnCollisionEnter",parameters:"collision: Collision",description:"Called when this collider/rigidbody has begun touching another rigidbody/collider.",imports:[{type:"Collision",module:"UnityEngine"}]},{name:"OnCollisionExit",parameters:"collision: Collision",description:"Called when this collider/rigidbody has stopped touching another rigidbody/collider.",imports:[{type:"Collision",module:"UnityEngine"}]},{name:"OnCollisionStay",parameters:"collision: Collision",description:"Called once per frame for every collider/rigidbody that is touching rigidbody/collider.",imports:[{type:"Collision",module:"UnityEngine"}]},{name:"OnCollisionEnter2D",parameters:"collision: Collision2D",description:"Called when this collider/rigidbody has begun touching another rigidbody/collider in 2D.",imports:[{type:"Collision2D",module:"UnityEngine"}]},{name:"OnCollisionExit2D",parameters:"collision: Collision2D",description:"Called when this collider/rigidbody has stopped touching another rigidbody/collider in 2D.",imports:[{type:"Collision2D",module:"UnityEngine"}]},{name:"OnCollisionStay2D",parameters:"collision: Collision2D",description:"Called once per frame for every collider/rigidbody that is touching rigidbody/collider in 2D.",imports:[{type:"Collision2D",module:"UnityEngine"}]},{name:"OnTriggerEnter",parameters:"other: Collider",description:"Called when the Collider other enters the trigger.",imports:[{type:"Collider",module:"UnityEngine"}]},{name:"OnTriggerExit",parameters:"other: Collider",description:"Called when the Collider other has stopped touching the trigger.",imports:[{type:"Collider",module:"UnityEngine"}]},{name:"OnTriggerStay",parameters:"other: Collider",description:"Called once per frame for every Collider other that is touching the trigger.",imports:[{type:"Collider",module:"UnityEngine"}]},{name:"OnTriggerEnter2D",parameters:"other: Collider2D",description:"Called when the Collider other enters the trigger in 2D.",imports:[{type:"Collider2D",module:"UnityEngine"}]},{name:"OnTriggerExit2D",parameters:"other: Collider2D",description:"Called when the Collider other has stopped touching the trigger in 2D.",imports:[{type:"Collider2D",module:"UnityEngine"}]},{name:"OnTriggerStay2D",parameters:"other: Collider2D",description:"Called once per frame for every Collider other that is touching the trigger in 2D.",imports:[{type:"Collider2D",module:"UnityEngine"}]},{name:"OnControllerColliderHit",parameters:"hit: ControllerColliderHit",description:"Called when the character controller hits a collider while performing a move.",imports:[{type:"ControllerColliderHit",module:"UnityEngine"}]},{name:"OnGUI",parameters:"",description:"Called for rendering and handling GUI events.",imports:[]},{name:"OnMouseDown",parameters:"",description:"Called when the user has pressed the mouse button while over the GUIElement or Collider.",imports:[]},{name:"OnMouseDrag",parameters:"",description:"Called when the user has clicked on a GUIElement or Collider and is still holding down the mouse.",imports:[]},{name:"OnMouseUp",parameters:"",description:"Called when the user has released the mouse button.",imports:[]},{name:"OnMouseEnter",parameters:"",description:"Called when the mouse enters the GUIElement or Collider.",imports:[]},{name:"OnMouseExit",parameters:"",description:"Called when the mouse is not any longer over the GUIElement or Collider.",imports:[]},{name:"OnMouseOver",parameters:"",description:"Called every frame while the mouse is over the GUIElement or Collider.",imports:[]},{name:"OnMouseUpAsButton",parameters:"",description:"Called when the user has pressed the mouse button while over the GUIElement or Collider and is still holding down the mouse.",imports:[]},{name:"OnApplicationFocus",parameters:"hasFocus: boolean",description:"Called when the application gains or loses focus.",imports:[]},{name:"OnApplicationPause",parameters:"pauseStatus: boolean",description:"Called when the application is paused or resumed.",imports:[]},{name:"OnApplicationQuit",parameters:"",description:"Called when the application is about to quit.",imports:[]},{name:"OnPreRender",parameters:"",description:"Called before a camera starts rendering the scene.",imports:[]},{name:"OnPostRender",parameters:"",description:"Called after a camera has finished rendering the scene.",imports:[]},{name:"OnRenderImage",parameters:"source: RenderTexture, destination: RenderTexture",description:"Called after all rendering is complete to render image.",imports:[{type:"RenderTexture",module:"UnityEngine"}]},{name:"OnRenderObject",parameters:"",description:"Called after camera has rendered the scene.",imports:[]},{name:"OnWillRenderObject",parameters:"",description:"Called once for each camera if the object is visible.",imports:[]},{name:"OnPreCull",parameters:"",description:"Called before the camera culls the scene.",imports:[]},{name:"OnAnimatorIK",parameters:"layerIndex: number",description:"Called right after the Animator has performed IK pass.",imports:[]},{name:"OnAnimatorMove",parameters:"",description:"Called right after the Animator updates.",imports:[]},{name:"OnDrawGizmos",parameters:"",description:"Called when the editor draws gizmos.",imports:[]},{name:"OnValidate",parameters:"",description:"Called when the script is loaded or a value is changed in the inspector.",imports:[]},{name:"OnExperiencePaused",parameters:"",description:"Called when the experience is paused.",imports:[]},{name:"OnExperienceResumed",parameters:"",description:"Called when the experience is resumed.",imports:[]},{name:"OnExperienceQuit",parameters:"",description:"Called when the experience is quit.",imports:[]}],t.ScriptableObjectAllowedMethods=["Awake","OnEnable","OnDisable","OnDestroy","OnValidate","OnApplicationFocus","OnApplicationPause","OnApplicationQuit","OnExperiencePaused","OnExperienceResumed","OnExperienceQuit"]},741:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeniesLifecycleEventsCompletions=void 0;const i=n(985),r=n(710),o=n(71),s=n(60);t.GeniesLifecycleEventsCompletions=class{constructor(e){this.context=e}get Logger(){return this.context.Logger}enhanceProxy(e){const t=e.getCompletionsAtPosition;e.getCompletionsAtPosition=(e,n,i)=>this.getCompletionsAtPosition(t,e,n,i);const n=e.getCompletionEntryDetails;e.getCompletionEntryDetails=(e,t,i,r,o,s,a)=>this.getCompletionEntryDetails(n,e,t,i,r,o,s,a)}getCompletionsAtPosition(e,t,n,r){var o,a,l,c;this.Logger.info("Getting completions at position.");const p=e(t,n,r),g=[],d=this.context.getSourceFile(t),m=null!==(o=null==p?void 0:p.entries.filter((e=>!s.unityLifecycleMethods.find((t=>t.name==e.name)))))&&void 0!==o?o:[];if(d){const e=this.getRelevantMethods(d,n);e&&g.push(...e.map((e=>({name:e.name,kind:i.ScriptElementKind.memberFunctionElement,kindModifiers:"private",sortText:"0",insertText:`private ${e.name}(${e.parameters}) {\n    // ${e.description}\n}`,labelDetails:{description:e.description},hasAction:!0}))))}return this.Logger.info("Adding completions for Unity lifecycle methods."),{isGlobalCompletion:null!==(a=null==p?void 0:p.isGlobalCompletion)&&void 0!==a&&a,isMemberCompletion:null!==(l=null==p?void 0:p.isMemberCompletion)&&void 0!==l&&l,isNewIdentifierLocation:null!==(c=null==p?void 0:p.isNewIdentifierLocation)&&void 0!==c&&c,entries:[...null!=m?m:[],...g]}}getCompletionEntryDetails(e,t,n,r,o,s,a,l){const c=e(t,n,r,o,s,a,l);if(c)return c;const p=this.context.getSourceFile(t);if(!p)return c;const g=this.getRelevantMethods(p,n);if(!g)return c;const d=g.find((e=>e.name===r));if(d){const e=[{text:"private",kind:"keyword"},{text:" ",kind:"space"},{text:d.name,kind:"methodName"},{text:"(",kind:"punctuation"}];d.parameters&&e.push(...d.parameters.split(",").flatMap((e=>[{text:e.split(":")[0].trim(),kind:"parameterName"},{text:": ",kind:"punctuation"},{text:e.split(":")[1].trim(),kind:"type"},{text:", ",kind:"punctuation"}])).slice(0,-1)),e.push({text:")",kind:"punctuation"},{text:" ",kind:"space"});const n=this.createImportChanges(t,d.imports);return{name:d.name,kind:i.ScriptElementKind.memberFunctionElement,kindModifiers:"private",displayParts:e,documentation:[{text:d.description,kind:"text"}],tags:[],codeActions:[{description:`Add necessary imports for ${d.name}`,changes:n}]}}}createImportChanges(e,t){const n=this.context.getSourceFile(e);if(!n)return[];const i=[],r=new Map;return n.getImportDeclarations().forEach((e=>{const t=e.getModuleSpecifierValue(),n=new Set(e.getNamedImports().map((e=>e.getName())));r.set(t,n)})),t.forEach((e=>{const t=r.get(e.module);t?t.has(e.type)||t.add(e.type):r.set(e.module,new Set([e.type]))})),r.forEach(((t,r)=>{const o=n.getImportDeclaration(r);if(o){const n=o.getNamedImports().map((e=>e.getName())),r=Array.from(t).filter((e=>!n.includes(e)));if(r.length>0){const t=o.getNamedImports().pop();t&&i.push({fileName:e,textChanges:[{newText:`, ${r.join(", ")}`,span:{start:t.getEnd(),length:0}}]})}}else i.push({fileName:e,textChanges:[{newText:`import { ${Array.from(t).join(", ")} } from '${r}';\n`,span:{start:0,length:0}}]})})),i}getRelevantMethods(e,t){let n;e.refreshFromFileSystemSync();const i=e.getDescendantAtPos(t);if(i){const e=this.getEnclosingClassDeclaration(i,t),a=i.getParent();if(!a||a.getKind()!==r.SyntaxKind.ClassDeclaration)return;if(e){const t=e.getType(),i=(0,o.getGeniesScriptTypeFromType)(t);if(i===o.GeniesScriptType.None)return void this.Logger.info("No relevant methods found for the script type.");const r=e.getMethods().map((e=>e.getName())),a=s.unityLifecycleMethods.filter((e=>!r.includes(e.name)));i===o.GeniesScriptType.Monobehaviour?n=a:i===o.GeniesScriptType.ScriptableObject&&(n=a.filter((e=>s.ScriptableObjectAllowedMethods.includes(e.name))))}}return n}getEnclosingClassDeclaration(e,t){let n=e;for(;n;){if(n.getKind()===r.SyntaxKind.ClassDeclaration){const e=n,i=e.getStart(),r=e.getEnd();if(i<=t&&t<=r)return e}n=n.getParent()}}}},830:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeniesLifecycleEventsDiagnostics=void 0;const i=n(60),r=n(71);t.GeniesLifecycleEventsDiagnostics=class{constructor(e){this.context=e}get Logger(){return this.context.Logger}enhanceProxy(e){const t=e.getSuggestionDiagnostics;e.getSuggestionDiagnostics=e=>{const n=t(e);return this.getSuggestionDiagnostics(n,e)}}getSuggestionDiagnostics(e,t){const n=this.context.getSourceFile(t);if(!n)return e;const o=new Set(i.unityLifecycleMethods.map((e=>e.name)));return n.getClasses().filter((e=>(0,r.isGeniesScriptType)(e.getType()))).flatMap((e=>e.getMethods())).filter((e=>o.has(e.getName()))).forEach((t=>{e.filter((e=>6133===e.code&&e.start===t.getNameNode().getStart())).forEach((t=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}))})),e}}},400:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeniesScriptTypeDiagnostics=void 0;const i=n(71);t.GeniesScriptTypeDiagnostics=class{constructor(e){this.context=e}get Logger(){return this.context.Logger}enhanceProxy(e){const t=e.getSuggestionDiagnostics;e.getSuggestionDiagnostics=e=>{const n=t(e);return this.getSuggestionDiagnostics(n,e)}}getSuggestionDiagnostics(e,t){const n=this.context.getSourceFile(t);return n?(n.getClasses().filter((e=>(0,i.isGeniesScriptType)(e.getType()))).forEach((t=>{e.filter((e=>(this.Logger.info(`found class ${t.getName()} with range ${t.getStart()} - ${t.getEnd()}`),this.Logger.info(`Code = ${e.code}`),this.Logger.info(`Diagnostic start = ${e.start}`),this.Logger.info(`Diagnostic Message = ${e.messageText}`),6196===e.code&&e.start>=t.getStart()&&e.start<=t.getEnd()))).forEach((t=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}))})),e):e}}},26:(e,t,n)=>{const i=n(710),r=n(741),o=n(54),s=n(830),a=n(400),l=n(335),c=n(865);e.exports=e=>{let t,n;return{create:function(e){e.project.projectService.logger.info("I'm getting set up now! Check the log for this message."),t=new i.Project({compilerOptions:e.project.getCompilerOptions(),skipAddingFilesFromTsConfig:!0}),n=new l.GeniesLSPContext(t,e);const p=[new r.GeniesLifecycleEventsCompletions(n),new o.CSharpOperatorOverloadingSuppress(n),new s.GeniesLifecycleEventsDiagnostics(n),new a.GeniesScriptTypeDiagnostics(n),new c.GeniesSemanticDiagnostics(n)],g=Object.create(null);for(const t of Object.keys(e.languageService)){const n=e.languageService[t];g[t]=(...t)=>n.apply(e.languageService,t)}return p.forEach((e=>e.enhanceProxy(g))),g}}}},710:e=>{e.exports=require("ts-morph")},985:e=>{e.exports=require("typescript/lib/tsserverlibrary")},928:e=>{e.exports=require("path")}},t={};return function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}(26)})()));
//# sourceMappingURL=index.js.map